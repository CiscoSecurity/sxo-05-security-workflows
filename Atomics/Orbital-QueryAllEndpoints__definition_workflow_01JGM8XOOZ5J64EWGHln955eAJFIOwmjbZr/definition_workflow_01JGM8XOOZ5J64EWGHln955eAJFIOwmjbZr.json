{
  "workflow": {
    "unique_name": "definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr",
    "name": "Orbital - Query All Endpoints",
    "title": "Orbital - Query All Endpoints",
    "type": "generic.workflow",
    "base_type": "workflow",
    "variables": [
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Orbital Job Name",
          "type": "datatype.string",
          "description": "A name for the Orbital query job. This will show in the job results and in the job list in Orbital",
          "is_required": true,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCL8NJ2QcI1lUMksO4uAjPZAoglR",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "output",
          "name": "Orbital Result",
          "type": "datatype.string",
          "description": "The result of the Orbital query. Note: if you set Wait for Completion to false, this field will be empty",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCLJR95aRiy0KBGi0AdBneH5tZ9g",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.boolean",
        "properties": {
          "value": true,
          "scope": "input",
          "name": "Wait For Query Completion",
          "type": "datatype.boolean",
          "description": "Whether or not to wait for the Orbital query to complete before this action ends. If true, the action will wait until a result is obtained from Orbital or the Query Wait Timeout expires. If false, the action will return the Orbital Job ID for the query without waiting for the query to complete. You can then use the job ID to fetch status and results later",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCLCNK4sWmmEChXZug28aJ9QANdy",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "local",
          "name": "orbitalQuery",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCLGCH4bbBijuVccNaa2g3Lyry4f",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Orbital SQL Query",
          "type": "datatype.string",
          "description": "Raw SQL query to be executed on the endpoint provided. You must provide this or an Orbital Catalog Query ID",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCLHGH6d9lwc3hvI4sBaCDZlLjXi",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Orbital Catalog Query ID",
          "type": "datatype.string",
          "description": "The ID of a catalog query from Orbital. This is found by viewing the query in the Orbital catalog and looking for the ID. For example, for Logged in Users the ID is logged_in_users. You must provide this or an Orbital SQL Query",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCL3992k7Wt6FuiBlIzEIMI6V8y5",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.secure_string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Access Token",
          "type": "datatype.secure_string",
          "description": "The bearer token to use to authentiate to the Orbital API",
          "is_required": true,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCLEYQ14xbtBvSGBBOU8JPkGibyq",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.integer",
        "properties": {
          "value": 2,
          "scope": "input",
          "name": "Query Expiration Time (Minutes)",
          "type": "datatype.integer",
          "description": "How long (in minutes) Orbital will wait to get a response for this query. After the expiration time, Orbital will stop trying to get a response and will not deliver a result. Must be at least 1 minute",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCLKTJ3rIoOhQoYD6yS9xhkRIIer",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "local",
          "name": "orbitalNode",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCLDTE5o3h5EigSqZQYAvRRnNAwg",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "output",
          "name": "Orbital Job ID",
          "type": "datatype.string",
          "description": "The job ID for this task/query from Orbital. This ID can be used to fetch job status and results later",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01JGM8XOCL61S7FlUgD7FR9kGp6ljbzir8A",
        "object_type": "variable_workflow"
      }
    ],
    "properties": {
      "atomic": {
        "atomic_group": "Cisco Orbital",
        "is_atomic": true
      },
      "delete_workflow_instance": false,
      "description": "Executes an Orbital catalog query or SQL query on all endpoints. Waiting for the query to complete is optional. You can specify how long Orbital should wait for a result before the job expires.\n\n[] Validate required input\n[] Build the endpoint identifier for the query\n[] Validate that an identifier was provided\n[] Check the type of query being executed and format it\n[] Calculate the expiry time\n[] Send the query request to Orbital\n[] Check if the job was started successfully\n[] Get the job ID from the Orbital response and add it to an output variable\n[] Check if we're waiting for the Orbital query to finish (if not, end the task)\n[] Loop until the Orbital job finishes or expires\n[]\u003e Check if the job has expired (if it is, end the task)\n[]\u003e Attempt to fetch job results from Orbital\n[]\u003e Check if a result was obtained (if not, sleep for 1 second and try again)",
      "display_name": "Orbital - Query All Endpoints",
      "runtime_user": {
        "override_target_runtime_user": false,
        "specify_on_workflow_start": false,
        "target_default": true
      },
      "target": {
        "target_type": "web-service.endpoint",
        "specify_on_workflow_start": true
      }
    },
    "object_type": "definition_workflow",
    "actions": [
      {
        "unique_name": "definition_activity_01JGM8YMQXBPW4ZwiH7oDL2GUrSCkfKAQWi",
        "name": "Condition Block",
        "title": "Was the necessary input provided?",
        "type": "logic.if_else",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Was the necessary input provided?",
          "skip_execution": false
        },
        "object_type": "definition_activity",
        "blocks": [
          {
            "unique_name": "definition_activity_01JGM8YW7VSAG2NiH4BJUhrFbcvUfIKr3S9",
            "name": "Condition Branch",
            "title": "Query expiration time is 0",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCLKTJ3rIoOhQoYD6yS9xhkRIIer$",
                "operator": "eq",
                "right_operand": 0
              },
              "continue_on_failure": false,
              "display_name": "Query expiration time is 0",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JGM8Z1AIJC53Viur1gpgL8j7Esr7hIxMP",
                "name": "Failed",
                "title": "Completed",
                "type": "logic.completed",
                "base_type": "activity",
                "properties": {
                  "completion_type": "failed-completed",
                  "display_name": "Failed",
                  "result_message": "Query expiration time must be greater than or equal to 1"
                },
                "object_type": "definition_activity"
              }
            ]
          },
          {
            "unique_name": "definition_activity_01JGM8ZB014DA6vW7a7tIBQc96vhYexbNJn",
            "name": "Condition Branch",
            "title": "No query or catalog ID",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": {
                  "left_operand": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCL3992k7Wt6FuiBlIzEIMI6V8y5$",
                  "operator": "eq",
                  "right_operand": ""
                },
                "operator": "and",
                "right_operand": {
                  "left_operand": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCLHGH6d9lwc3hvI4sBaCDZlLjXi$",
                  "operator": "eq",
                  "right_operand": ""
                }
              },
              "continue_on_failure": false,
              "display_name": "No query or catalog ID",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JGM8ZFUAWQ338aZJ4FpmTyiqwGeLQiTk1",
                "name": "Failed",
                "title": "Failed",
                "type": "logic.completed",
                "base_type": "activity",
                "properties": {
                  "completion_type": "failed-completed",
                  "display_name": "Failed",
                  "result_message": "You must provide either an Orbital Catalog Query ID or Orbital SQL Query"
                },
                "object_type": "definition_activity"
              }
            ]
          }
        ]
      },
      {
        "unique_name": "definition_activity_01JGM92XY919B73TDUi534FooHNZKOgqTGK",
        "name": "Condition Block",
        "title": "SQL or catalog query?",
        "type": "logic.if_else",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "SQL or catalog query?",
          "skip_execution": false
        },
        "object_type": "definition_activity",
        "blocks": [
          {
            "unique_name": "definition_activity_01JGM938588FE6iKO5vRKBQMJWxeMpoZnQD",
            "name": "Condition Branch",
            "title": "Catalog query",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCL3992k7Wt6FuiBlIzEIMI6V8y5$",
                "operator": "ne",
                "right_operand": ""
              },
              "continue_on_failure": false,
              "display_name": "Catalog query",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JGM93EWAZDN2fgBSU2IHRWPWTzmwdblvu",
                "name": "Set Variables",
                "title": "Set query value",
                "type": "core.set_multiple_variables",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Set query value",
                  "skip_execution": false,
                  "variables_to_update": [
                    {
                      "variable_to_update": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.local.variable_workflow_01JGM8XOCLGCH4bbBijuVccNaa2g3Lyry4f$",
                      "variable_value_new": "\"stock\": \"$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCL3992k7Wt6FuiBlIzEIMI6V8y5$\""
                    }
                  ]
                },
                "object_type": "definition_activity"
              }
            ]
          },
          {
            "unique_name": "definition_activity_01JGM946NFYY72TDUhS9Y4dZEF05G7Fbjqv",
            "name": "Condition Branch",
            "title": "SQL query",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCLHGH6d9lwc3hvI4sBaCDZlLjXi$",
                "operator": "ne",
                "right_operand": ""
              },
              "continue_on_failure": false,
              "display_name": "SQL query",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JGM94LNA91C02rqovHcTWrWamKCMwEASn",
                "name": "Replace String",
                "title": "Initial query clean",
                "type": "core.replacestring",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Initial query clean",
                  "input_string": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCLHGH6d9lwc3hvI4sBaCDZlLjXi$",
                  "replace_list": [
                    {
                      "replaced_string": "\\n",
                      "replacement_string": " "
                    },
                    {
                      "replaced_string": "\\r",
                      "replacement_string": " "
                    },
                    {
                      "replaced_string": "\\t",
                      "replacement_string": " "
                    }
                  ],
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01JGM94W53P7X1i6M5MIGVfsPF9ayIrnJar",
                "name": "Execute Python Script",
                "title": "Deeper query clean",
                "type": "python3.script",
                "base_type": "activity",
                "properties": {
                  "action_timeout": 180,
                  "continue_on_failure": false,
                  "display_name": "Deeper query clean",
                  "script": "import sys\n\nrawQuery = sys.argv[1]\ncleanQuery = rawQuery.replace('\"', '\\\\\"')",
                  "script_arguments": [
                    "$activity.definition_activity_01JGM94LNA91C02rqovHcTWrWamKCMwEASn.output.result_string$"
                  ],
                  "script_queries": [
                    {
                      "script_query": "cleanQuery",
                      "script_query_name": "cleanQuery",
                      "script_query_type": "string"
                    }
                  ],
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01JGM9576LJ6Z1RW9CnDLWJuH316nBq1gmQ",
                "name": "Set Variables",
                "title": "Set query value",
                "type": "core.set_multiple_variables",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Set query value",
                  "skip_execution": false,
                  "variables_to_update": [
                    {
                      "variable_to_update": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.local.variable_workflow_01JGM8XOCLGCH4bbBijuVccNaa2g3Lyry4f$",
                      "variable_value_new": "\"osQuery\": [ { \"sql\": \"$activity.definition_activity_01JGM94W53P7X1i6M5MIGVfsPF9ayIrnJar.output.script_queries.cleanQuery$\" } ]"
                    }
                  ]
                },
                "object_type": "definition_activity"
              }
            ]
          }
        ]
      },
      {
        "unique_name": "definition_activity_01JGM95HZ31AY2Ux4uYRpdshn0efYdzsZsu",
        "name": "Execute Python Script",
        "title": "Calculate expiry time",
        "type": "python3.script",
        "base_type": "activity",
        "properties": {
          "action_timeout": 180,
          "continue_on_failure": false,
          "display_name": "Calculate expiry time",
          "script": "import time\nimport sys\n\nexpiryTime = int(time.time()) + (int(sys.argv[1]) * 60)",
          "script_arguments": [
            "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCLKTJ3rIoOhQoYD6yS9xhkRIIer$"
          ],
          "script_queries": [
            {
              "script_query": "expiryTime",
              "script_query_name": "expiryTime",
              "script_query_type": "string"
            }
          ],
          "skip_execution": false
        },
        "object_type": "definition_activity"
      },
      {
        "unique_name": "definition_activity_01JGM95SMK0QJ1oDlYrZ7o1mgqCuxzRIJhE",
        "name": "HTTP Request",
        "title": "Request query start",
        "type": "web-service.http_request",
        "base_type": "activity",
        "properties": {
          "action_timeout": 180,
          "allow_auto_redirect": true,
          "body": "{\n  \"name\": \"$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCL8NJ2QcI1lUMksO4uAjPZAoglR$\",\n\t$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.local.variable_workflow_01JGM8XOCLGCH4bbBijuVccNaa2g3Lyry4f$,\n\t\"nodes\": [ \"all\" ],\n\t\"expiry\": $activity.definition_activity_01JGM95HZ31AY2Ux4uYRpdshn0efYdzsZsu.output.script_queries.expiryTime$\n}",
          "content_type": "application/json",
          "continue_on_error_status_code": true,
          "continue_on_failure": true,
          "custom_headers": [
            {
              "name": "Authorization",
              "value": "Bearer $workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCLEYQ14xbtBvSGBBOU8JPkGibyq$"
            }
          ],
          "display_name": "Request query start",
          "method": "POST",
          "relative_url": "query",
          "runtime_user": {
            "override_target_runtime_user": false,
            "target_default": true
          },
          "skip_execution": false,
          "target": {
            "override_workflow_target": false,
            "override_workflow_target_group_criteria": false,
            "use_workflow_target": true,
            "use_workflow_target_group": false
          }
        },
        "object_type": "definition_activity"
      },
      {
        "unique_name": "definition_activity_01JGM963I7H9U0aisbXwTUDVETeWm763QFn",
        "name": "Condition Block",
        "title": "Job started?",
        "type": "logic.if_else",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Job started?",
          "skip_execution": false
        },
        "object_type": "definition_activity",
        "blocks": [
          {
            "unique_name": "definition_activity_01JGM96E4EORH6uBkVgDTVf42EUXxinIVqZ",
            "name": "Condition Branch",
            "title": "Job started",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": {
                  "left_operand": "$activity.definition_activity_01JGM95SMK0QJ1oDlYrZ7o1mgqCuxzRIJhE.output.succeeded$",
                  "operator": "eq",
                  "right_operand": true
                },
                "operator": "and",
                "right_operand": {
                  "left_operand": "$activity.definition_activity_01JGM95SMK0QJ1oDlYrZ7o1mgqCuxzRIJhE.output.status_code$",
                  "operator": "eq",
                  "right_operand": 200
                }
              },
              "continue_on_failure": false,
              "display_name": "Job started",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JGM96JGRSW4473tZJfOl3ce67GP6OyA1y",
                "name": "JSONPath Query",
                "title": "Get job ID",
                "type": "corejava.jsonpathquery",
                "base_type": "activity",
                "properties": {
                  "action_timeout": 180,
                  "continue_on_failure": false,
                  "display_name": "Get job ID",
                  "input_json": "$activity.definition_activity_01JGM95SMK0QJ1oDlYrZ7o1mgqCuxzRIJhE.output.response_body$",
                  "jsonpath_queries": [
                    {
                      "jsonpath_query": "$.ID",
                      "jsonpath_query_name": "orbitalQueryJobID",
                      "jsonpath_query_type": "string"
                    }
                  ],
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01JGM96UE8MKP4sed7b60F1AXH5EXAAWLTP",
                "name": "Set Variables",
                "title": "Set job ID output",
                "type": "core.set_multiple_variables",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Set job ID output",
                  "skip_execution": false,
                  "variables_to_update": [
                    {
                      "variable_to_update": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.output.variable_workflow_01JGM8XOCL61S7FlUgD7FR9kGp6ljbzir8A$",
                      "variable_value_new": "$activity.definition_activity_01JGM96JGRSW4473tZJfOl3ce67GP6OyA1y.output.jsonpath_queries.orbitalQueryJobID$"
                    }
                  ]
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01JGM975KTM0V6BcRIyTHkzWC2lPxQJbKtr",
                "name": "Condition Block",
                "title": "Are we waiting for a result?",
                "type": "logic.if_else",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Are we waiting for a result?",
                  "skip_execution": false
                },
                "object_type": "definition_activity",
                "blocks": [
                  {
                    "unique_name": "definition_activity_01JGM97FLJWQF1rKxAmJ5KFjNNRLh5gJEp0",
                    "name": "Condition Branch",
                    "title": "No",
                    "type": "logic.condition_block",
                    "base_type": "activity",
                    "properties": {
                      "condition": {
                        "left_operand": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCLCNK4sWmmEChXZug28aJ9QANdy$",
                        "operator": "eq",
                        "right_operand": false
                      },
                      "continue_on_failure": false,
                      "display_name": "No",
                      "skip_execution": false
                    },
                    "object_type": "definition_activity",
                    "actions": [
                      {
                        "unique_name": "definition_activity_01JGM97K3C0F25NLco7ntuqc6Lo3cCBBuZK",
                        "name": "Succeeded",
                        "title": "Succeeded",
                        "type": "logic.completed",
                        "base_type": "activity",
                        "properties": {
                          "completion_type": "succeeded",
                          "continue_on_failure": false,
                          "display_name": "Succeeded",
                          "result_message": "Orbital query executed successfully (but wait for query completion was false)",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity"
                      }
                    ]
                  }
                ]
              },
              {
                "unique_name": "definition_activity_01JGM97TYJIJH6ZJmNMcMwrRrfVnqW4gPo9",
                "name": "While Loop",
                "title": "Wait for job",
                "type": "logic.while",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Wait for job",
                  "skip_execution": false
                },
                "object_type": "definition_activity",
                "blocks": [
                  {
                    "unique_name": "definition_activity_01JGM9850363W6NnbJcDRvWQ6W0by0ps4j2",
                    "name": "Condition Branch",
                    "title": "Loop until job expires",
                    "type": "logic.condition_block",
                    "base_type": "activity",
                    "properties": {
                      "condition": {
                        "left_operand": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.output.instance_id$",
                        "operator": "eq",
                        "right_operand": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.output.instance_id$"
                      },
                      "continue_on_failure": false,
                      "display_name": "Loop until job expires",
                      "skip_execution": false
                    },
                    "object_type": "definition_activity",
                    "actions": [
                      {
                        "unique_name": "definition_activity_01JGM98AS4QVA7m81MGBcaA8oaff0Gt7eM2",
                        "name": "Execute Python Script",
                        "title": "Check if job is expired",
                        "type": "python3.script",
                        "base_type": "activity",
                        "properties": {
                          "action_timeout": 180,
                          "continue_on_failure": false,
                          "display_name": "Check if job is expired",
                          "script": "import time\nimport sys\n\nexpiryTime = int(sys.argv[1])\ncurrentTime = int(time.time())\n\nexpired = (expiryTime \u003c currentTime)",
                          "script_arguments": [
                            "$activity.definition_activity_01JGM95HZ31AY2Ux4uYRpdshn0efYdzsZsu.output.script_queries.expiryTime$"
                          ],
                          "script_queries": [
                            {
                              "script_query": "expired",
                              "script_query_name": "queryExpired",
                              "script_query_type": "boolean"
                            }
                          ],
                          "skip_execution": false
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_01JGM98LKRGC266ex8fJWJwKY2msevR8P0h",
                        "name": "Condition Block",
                        "title": "Has the job expired?",
                        "type": "logic.if_else",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "Has the job expired?",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity",
                        "blocks": [
                          {
                            "unique_name": "definition_activity_01JGM98W52VCR0SG4mtFyuAepfdw7cyebGg",
                            "name": "Condition Branch",
                            "title": "Yes",
                            "type": "logic.condition_block",
                            "base_type": "activity",
                            "properties": {
                              "condition": {
                                "left_operand": "$activity.definition_activity_01JGM98AS4QVA7m81MGBcaA8oaff0Gt7eM2.output.script_queries.queryExpired$",
                                "operator": "eq",
                                "right_operand": true
                              },
                              "continue_on_failure": false,
                              "display_name": "Yes",
                              "skip_execution": false
                            },
                            "object_type": "definition_activity",
                            "actions": [
                              {
                                "unique_name": "definition_activity_01JGM99D8C5YX02LvRx339oRyW4G0ITR5CV",
                                "name": "HTTP Request",
                                "title": "Check job status",
                                "type": "web-service.http_request",
                                "base_type": "activity",
                                "properties": {
                                  "action_timeout": 180,
                                  "allow_auto_redirect": true,
                                  "continue_on_error_status_code": false,
                                  "continue_on_failure": false,
                                  "custom_headers": [
                                    {
                                      "name": "Authorization",
                                      "value": "Bearer $workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCLEYQ14xbtBvSGBBOU8JPkGibyq$"
                                    }
                                  ],
                                  "display_name": "Check job status",
                                  "method": "GET",
                                  "relative_url": "jobs/$activity.definition_activity_01JGM96JGRSW4473tZJfOl3ce67GP6OyA1y.output.jsonpath_queries.orbitalQueryJobID$",
                                  "runtime_user": {
                                    "override_target_runtime_user": false,
                                    "target_default": true
                                  },
                                  "skip_execution": false,
                                  "target": {
                                    "override_workflow_target": false,
                                    "override_workflow_target_group_criteria": false,
                                    "use_workflow_target": true,
                                    "use_workflow_target_group": false
                                  }
                                },
                                "object_type": "definition_activity"
                              },
                              {
                                "unique_name": "definition_activity_01JGM99O2Z84H3WtqXVMrNCNiDaSiSAULe3",
                                "name": "Condition Block",
                                "title": "Did we get job status?",
                                "type": "logic.if_else",
                                "base_type": "activity",
                                "properties": {
                                  "continue_on_failure": false,
                                  "display_name": "Did we get job status?",
                                  "skip_execution": false
                                },
                                "object_type": "definition_activity",
                                "blocks": [
                                  {
                                    "unique_name": "definition_activity_01JGM99YBRMBN13mWhBxxVsOfaxm227x9im",
                                    "name": "Condition Branch",
                                    "title": "Success/200",
                                    "type": "logic.condition_block",
                                    "base_type": "activity",
                                    "properties": {
                                      "condition": {
                                        "left_operand": "$activity.definition_activity_01JGM99D8C5YX02LvRx339oRyW4G0ITR5CV.output.status_code$",
                                        "operator": "eq",
                                        "right_operand": 200
                                      },
                                      "continue_on_failure": false,
                                      "display_name": "Success/200",
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity",
                                    "actions": [
                                      {
                                        "unique_name": "definition_activity_01JGM9A4SX8SO3XCDS8TY4g8lmdF3bLk9dj",
                                        "name": "JSONPath Query",
                                        "title": "Extract done count",
                                        "type": "corejava.jsonpathquery",
                                        "base_type": "activity",
                                        "properties": {
                                          "action_timeout": 180,
                                          "continue_on_failure": false,
                                          "display_name": "Extract done count",
                                          "input_json": "$activity.definition_activity_01JGM99D8C5YX02LvRx339oRyW4G0ITR5CV.output.response_body$",
                                          "jsonpath_queries": [
                                            {
                                              "jsonpath_query": "$.done_count",
                                              "jsonpath_query_name": "doneCount",
                                              "jsonpath_query_type": "integer"
                                            }
                                          ],
                                          "skip_execution": false
                                        },
                                        "object_type": "definition_activity"
                                      },
                                      {
                                        "unique_name": "definition_activity_01JGM9AHO8MS56qgGiT37VXt3Dv5XlmWtvN",
                                        "name": "Condition Block",
                                        "title": "Is the done count greater than 0?",
                                        "type": "logic.if_else",
                                        "base_type": "activity",
                                        "properties": {
                                          "continue_on_failure": false,
                                          "display_name": "Is the done count greater than 0?",
                                          "skip_execution": false
                                        },
                                        "object_type": "definition_activity",
                                        "blocks": [
                                          {
                                            "unique_name": "definition_activity_01JGM9ARRC0MQ5HdzUF3g4ZOmtAznDIOCy5",
                                            "name": "Condition Branch",
                                            "title": "Yes",
                                            "type": "logic.condition_block",
                                            "base_type": "activity",
                                            "properties": {
                                              "condition": {
                                                "left_operand": "$activity.definition_activity_01JGM9A4SX8SO3XCDS8TY4g8lmdF3bLk9dj.output.jsonpath_queries.doneCount$",
                                                "operator": "gt",
                                                "right_operand": 0
                                              },
                                              "continue_on_failure": false,
                                              "display_name": "Yes",
                                              "skip_execution": false
                                            },
                                            "object_type": "definition_activity",
                                            "actions": [
                                              {
                                                "unique_name": "definition_activity_01JGM9AXLAWW21dxDtSdJIf7eTi2K2pUJyw",
                                                "name": "HTTP Request",
                                                "title": "Get job results",
                                                "type": "web-service.http_request",
                                                "base_type": "activity",
                                                "properties": {
                                                  "action_timeout": 180,
                                                  "allow_auto_redirect": true,
                                                  "continue_on_error_status_code": false,
                                                  "continue_on_failure": false,
                                                  "custom_headers": [
                                                    {
                                                      "name": "Authorization",
                                                      "value": "Bearer $workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.input.variable_workflow_01JGM8XOCLEYQ14xbtBvSGBBOU8JPkGibyq$"
                                                    }
                                                  ],
                                                  "display_name": "Get job results",
                                                  "method": "GET",
                                                  "relative_url": "jobs/$activity.definition_activity_01JGM96JGRSW4473tZJfOl3ce67GP6OyA1y.output.jsonpath_queries.orbitalQueryJobID$/results",
                                                  "runtime_user": {
                                                    "override_target_runtime_user": false,
                                                    "target_default": true
                                                  },
                                                  "skip_execution": false,
                                                  "target": {
                                                    "override_workflow_target": false,
                                                    "override_workflow_target_group_criteria": false,
                                                    "use_workflow_target": true,
                                                    "use_workflow_target_group": false
                                                  }
                                                },
                                                "object_type": "definition_activity"
                                              },
                                              {
                                                "unique_name": "definition_activity_01JGM9B9XB82064Te1cA3Pmvl6u18MlAaNd",
                                                "name": "JSONPath Query",
                                                "title": "Extract result values",
                                                "type": "corejava.jsonpathquery",
                                                "base_type": "activity",
                                                "properties": {
                                                  "action_timeout": 180,
                                                  "continue_on_failure": false,
                                                  "display_name": "Extract result values",
                                                  "input_json": "$activity.definition_activity_01JGM9AXLAWW21dxDtSdJIf7eTi2K2pUJyw.output.response_body$",
                                                  "jsonpath_queries": [
                                                    {
                                                      "jsonpath_query": "$.results",
                                                      "jsonpath_query_name": "orbitalQueryResult",
                                                      "jsonpath_query_type": "string"
                                                    }
                                                  ],
                                                  "skip_execution": false
                                                },
                                                "object_type": "definition_activity"
                                              },
                                              {
                                                "unique_name": "definition_activity_01JGM9BL2785W6LsJnUPgXhUAvMo8BG8hfG",
                                                "name": "Set Variables",
                                                "title": "Set output variable",
                                                "type": "core.set_multiple_variables",
                                                "base_type": "activity",
                                                "properties": {
                                                  "continue_on_failure": false,
                                                  "display_name": "Set output variable",
                                                  "skip_execution": false,
                                                  "variables_to_update": [
                                                    {
                                                      "variable_to_update": "$workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.output.variable_workflow_01JGM8XOCLJR95aRiy0KBGi0AdBneH5tZ9g$",
                                                      "variable_value_new": "$activity.definition_activity_01JGM9B9XB82064Te1cA3Pmvl6u18MlAaNd.output.jsonpath_queries.orbitalQueryResult$"
                                                    }
                                                  ]
                                                },
                                                "object_type": "definition_activity"
                                              },
                                              {
                                                "unique_name": "definition_activity_01JGM9BZ0J2PH3ezn83ZYF8J57HNQVRv5sC",
                                                "name": "Break",
                                                "title": "Break",
                                                "type": "logic.break",
                                                "base_type": "activity",
                                                "properties": {
                                                  "continue_on_failure": false,
                                                  "display_name": "Break",
                                                  "skip_execution": false
                                                },
                                                "object_type": "definition_activity"
                                              }
                                            ]
                                          },
                                          {
                                            "unique_name": "definition_activity_01JGM9C9DGGT96Qp5Fjb9Y8aIh68t0RXVh4",
                                            "name": "Condition Branch",
                                            "title": "No",
                                            "type": "logic.condition_block",
                                            "base_type": "activity",
                                            "properties": {
                                              "condition": {
                                                "left_operand": "$activity.definition_activity_01JGM9A4SX8SO3XCDS8TY4g8lmdF3bLk9dj.output.jsonpath_queries.doneCount$",
                                                "operator": "eq",
                                                "right_operand": 0
                                              },
                                              "continue_on_failure": false,
                                              "display_name": "No",
                                              "skip_execution": false
                                            },
                                            "object_type": "definition_activity",
                                            "actions": [
                                              {
                                                "unique_name": "definition_activity_01KKV701WIKQV1SH1XEVmUvFtgKSaWSjGap",
                                                "name": "Failed",
                                                "title": "Failed",
                                                "type": "logic.completed",
                                                "base_type": "activity",
                                                "properties": {
                                                  "completion_type": "failed-completed",
                                                  "continue_on_failure": false,
                                                  "display_name": "Failed",
                                                  "result_message": "No results for job $activity.definition_activity_01JGM96JGRSW4473tZJfOl3ce67GP6OyA1y.output.jsonpath_queries.orbitalQueryJobID$",
                                                  "skip_execution": false
                                                },
                                                "object_type": "definition_activity"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "unique_name": "definition_activity_01JGM9COXJ8Y47jhuGkoyihYjlz2cqXYIft",
                                    "name": "Condition Branch",
                                    "title": "Failure/Anything else",
                                    "type": "logic.condition_block",
                                    "base_type": "activity",
                                    "properties": {
                                      "condition": {
                                        "left_operand": "$activity.definition_activity_01JGM99D8C5YX02LvRx339oRyW4G0ITR5CV.output.status_code$",
                                        "operator": "ne",
                                        "right_operand": 200
                                      },
                                      "continue_on_failure": false,
                                      "display_name": "Failure/Anything else",
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity",
                                    "actions": [
                                      {
                                        "unique_name": "definition_activity_01JGM9CU35NLR0HZvFsdi15H9bpulG1FAyp",
                                        "name": "Failed",
                                        "title": "Failed",
                                        "type": "logic.completed",
                                        "base_type": "activity",
                                        "properties": {
                                          "completion_type": "failed-completed",
                                          "continue_on_failure": false,
                                          "display_name": "Failed",
                                          "result_message": "Failed to retrieve status for job $activity.definition_activity_01JGM96JGRSW4473tZJfOl3ce67GP6OyA1y.output.jsonpath_queries.orbitalQueryJobID$ from Orbital",
                                          "skip_execution": false
                                        },
                                        "object_type": "definition_activity"
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "unique_name": "definition_activity_01KKV5WDFOQHS390zYqDHMpeQNOmLCqlfGj",
                            "name": "Condition Branch",
                            "title": "No",
                            "type": "logic.condition_block",
                            "base_type": "activity",
                            "properties": {
                              "condition": {
                                "left_operand": "$activity.definition_activity_01JGM98AS4QVA7m81MGBcaA8oaff0Gt7eM2.output.script_queries.queryExpired$",
                                "operator": "eq",
                                "right_operand": false
                              },
                              "continue_on_failure": false,
                              "display_name": "No",
                              "skip_execution": false
                            },
                            "object_type": "definition_activity",
                            "actions": [
                              {
                                "unique_name": "definition_activity_01JGM9CENHTWB4witnAZz6Y3iesRrq74PNw",
                                "name": "Sleep",
                                "title": "Sleep",
                                "type": "core.sleep",
                                "base_type": "activity",
                                "properties": {
                                  "continue_on_failure": false,
                                  "display_name": "Sleep",
                                  "skip_execution": false,
                                  "sleep_interval": 10
                                },
                                "object_type": "definition_activity"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "unique_name": "definition_activity_01JGM9D4DF2UB6yJezmKxEKuKq5HnhHNjTi",
            "name": "Condition Branch",
            "title": "Job failed to start",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": {
                  "left_operand": "$activity.definition_activity_01JGM95SMK0QJ1oDlYrZ7o1mgqCuxzRIJhE.output.succeeded$",
                  "operator": "eq",
                  "right_operand": false
                },
                "operator": "or",
                "right_operand": {
                  "left_operand": "$activity.definition_activity_01JGM95SMK0QJ1oDlYrZ7o1mgqCuxzRIJhE.output.status_code$",
                  "operator": "ne",
                  "right_operand": 200
                }
              },
              "continue_on_failure": false,
              "display_name": "Job failed to start",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JGM9D98JGRX0wnwX9ZSXojkjPbNOZmQb2",
                "name": "JSONPath Query",
                "title": "Get Orbital error",
                "type": "corejava.jsonpathquery",
                "base_type": "activity",
                "properties": {
                  "action_timeout": 180,
                  "continue_on_failure": true,
                  "display_name": "Get Orbital error",
                  "input_json": "$activity.definition_activity_01JGM95SMK0QJ1oDlYrZ7o1mgqCuxzRIJhE.output.response_body$",
                  "jsonpath_queries": [
                    {
                      "jsonpath_query": "$.error",
                      "jsonpath_query_name": "orbitalError",
                      "jsonpath_query_type": "string"
                    }
                  ],
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01JGM9DJZTHKP0TzIwsG7WHDDklVOP9ndyq",
                "name": "Condition Block",
                "title": "Which error?",
                "type": "logic.if_else",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Which error?",
                  "skip_execution": false
                },
                "object_type": "definition_activity",
                "blocks": [
                  {
                    "unique_name": "definition_activity_01JGM9DV7HAX13byfRJM3ACJi6Z6PYxHfoC",
                    "name": "Condition Branch",
                    "title": "No valid nodes",
                    "type": "logic.condition_block",
                    "base_type": "activity",
                    "properties": {
                      "condition": {
                        "left_operand": {
                          "left_operand": "$activity.definition_activity_01JGM9D98JGRX0wnwX9ZSXojkjPbNOZmQb2.output.succeeded$",
                          "operator": "eq",
                          "right_operand": true
                        },
                        "operator": "and",
                        "right_operand": {
                          "left_operand": "$activity.definition_activity_01JGM9D98JGRX0wnwX9ZSXojkjPbNOZmQb2.output.jsonpath_queries.orbitalError$",
                          "operator": "eq",
                          "right_operand": "query has no valid nodes"
                        }
                      },
                      "continue_on_failure": false,
                      "display_name": "No valid nodes",
                      "skip_execution": false
                    },
                    "object_type": "definition_activity",
                    "actions": [
                      {
                        "unique_name": "definition_activity_01JGM9E088UXW6SwDcQccCWcTKO69KME65f",
                        "name": "Succeeded",
                        "title": "Node not found",
                        "type": "logic.completed",
                        "base_type": "activity",
                        "properties": {
                          "completion_type": "failed-completed",
                          "continue_on_failure": false,
                          "display_name": "Node not found",
                          "result_message": "Unable to execute Orbital query for $workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.local.variable_workflow_01JGM8XOCLDTE5o3h5EigSqZQYAvRRnNAwg$ as the requested endpoint was not found",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity"
                      }
                    ]
                  },
                  {
                    "unique_name": "definition_activity_01JGM9EC7DQYH6MZGhxaNZtGpAyDDbonBpB",
                    "name": "Condition Branch",
                    "title": "Something else",
                    "type": "logic.condition_block",
                    "base_type": "activity",
                    "properties": {
                      "condition": {
                        "left_operand": "$activity.definition_activity_01JGM9D98JGRX0wnwX9ZSXojkjPbNOZmQb2.output.succeeded$",
                        "operator": "eq",
                        "right_operand": true
                      },
                      "continue_on_failure": false,
                      "display_name": "Something else",
                      "skip_execution": false
                    },
                    "object_type": "definition_activity",
                    "actions": [
                      {
                        "unique_name": "definition_activity_01JGM9EHBFETY543oV4UfuBIwxVZhkHY2zs",
                        "name": "Failed",
                        "title": "Failed",
                        "type": "logic.completed",
                        "base_type": "activity",
                        "properties": {
                          "completion_type": "failed-completed",
                          "continue_on_failure": false,
                          "display_name": "Failed",
                          "result_message": "Unable to execute Orbital query for $workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.local.variable_workflow_01JGM8XOCLDTE5o3h5EigSqZQYAvRRnNAwg$. The error returned from Orbital was: $activity.definition_activity_01JGM9D98JGRX0wnwX9ZSXojkjPbNOZmQb2.output.jsonpath_queries.orbitalError$",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity"
                      }
                    ]
                  },
                  {
                    "unique_name": "definition_activity_01JGM9ERZTGU06D74192wecmGtj6zyrRJnD",
                    "name": "Condition Branch",
                    "title": "No error found",
                    "type": "logic.condition_block",
                    "base_type": "activity",
                    "properties": {
                      "condition": {
                        "left_operand": "$activity.definition_activity_01JGM9D98JGRX0wnwX9ZSXojkjPbNOZmQb2.output.succeeded$",
                        "operator": "eq",
                        "right_operand": false
                      },
                      "continue_on_failure": false,
                      "display_name": "No error found",
                      "skip_execution": false
                    },
                    "object_type": "definition_activity",
                    "actions": [
                      {
                        "unique_name": "definition_activity_01JGM9EX6LHQE7IvMUJ9X1W50Bc3wiACDBc",
                        "name": "Failed",
                        "title": "Failed",
                        "type": "logic.completed",
                        "base_type": "activity",
                        "properties": {
                          "completion_type": "failed-completed",
                          "continue_on_failure": false,
                          "display_name": "Failed",
                          "result_message": "Unable to execute Orbital query for $workflow.definition_workflow_01JGM8XOOZ5J64EWGHln955eAJFIOwmjbZr.local.variable_workflow_01JGM8XOCLDTE5o3h5EigSqZQYAvRRnNAwg$",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ],
    "categories": [
      "category_1BMfMXSnJMyt5Ihqi7rWJr5N8cf"
    ]
  }
}